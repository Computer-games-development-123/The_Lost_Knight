using UnityEngine;

[RequireComponent(typeof(CharacterContext))]
public class Invulnerability : MonoBehaviour
{
    public float iFrameDuration = 1.5f;

    public bool IsInvulnerable { get; private set; }

    private float timer;
    private CharacterContext ctx;

    private void Awake()
    {
        ctx = GetComponent<CharacterContext>();
    }

    private void Update()
    {
        if (!IsInvulnerable) return;

        timer -= Time.deltaTime;
        if (timer <= 0f)
        {
            IsInvulnerable = false;
            ctx.SR.color = Color.white;
            return;
        }

        // Flicker
        float alpha = Mathf.PingPong(Time.time * 10f, 1f);
        ctx.SR.color = new Color(1f, 1f, 1f, alpha);
    }

    public void Trigger()
    {
        IsInvulnerable = true;
        timer = iFrameDuration;
    }
}
